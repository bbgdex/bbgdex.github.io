(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-43cff946"],{"4e77":function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"genesis-exchange"},[a("div",{staticClass:"remaining"},[a("div",{staticClass:"info"},[a("span",[t._v("1 USDT="+t._s(t.rate)+" BBG")]),a("span",[a("span",[t._v(t._s(t.exchanged))]),t._v("/"+t._s(t.maxQuota))])]),a("div",{staticClass:"proess"},[a("i",{style:{width:t.width+"%"}}),a("span",[t._v(t._s(t.width)+"%")])])]),a("div",{staticClass:"input"},[a("input",{directives:[{name:"model",rawName:"v-model",value:t.amount,expression:"amount"}],attrs:{type:"number",placeholder:t.$t("genesisExchange.text1")},domProps:{value:t.amount},on:{input:[function(e){e.target.composing||(t.amount=e.target.value)},t.input]}}),a("i"),a("span",[t._v("USDT")])]),a("span",{staticClass:"balance"},[t._v(t._s(t.$t("genesisExchange.text2"))),a("span",[t._v(t._s(t.balance))])]),a("span",{staticClass:"get"},[t._v(t._s(t.$t("genesisExchange.text3"))+" "),a("span",[t._v(t._s(t.receive))]),t._v(" BBG")]),a("van-button",{directives:[{name:"show",rawName:"v-show",value:"none"===t.tradeState,expression:"tradeState === 'none'"}],staticClass:"double-button",on:{click:t.exchange}},[t._v(t._s(t.btnText))]),a("van-button",{directives:[{name:"show",rawName:"v-show",value:"none"!==t.tradeState,expression:"tradeState !== 'none'"}],staticClass:"double-button",attrs:{loading:"","loading-text":t.btnText}})],1)},s=[],i=(a("b0c0"),a("a9e3"),a("b680"),a("e7e5"),a("d399")),o=(a("96cf"),a("1da1")),r=a("ade3"),c=(a("66b9"),a("b650")),d={components:Object(r["a"])({},c["a"].name,c["a"]),props:{exchanged:[String,Number],maxQuota:[String,Number]},data:function(){return{rate:0,amount:"",balance:0,receive:0,allowance:"0".toBN(),tradeState:"none"}},computed:{width:function(){return this.exchanged.toBN().div(this.maxQuota).times(100).toFixed()},btnText:function(){return"approving"===this.tradeState?this.$t("genesisExchange.text4"):"trading"===this.tradeState?this.$t("genesisExchange.text5"):this.allowance.lt(this.amount)?this.$t("genesisExchange.text6"):this.$t("genesisExchange.text7")}},created:function(){this.$contracts&&this.init()},methods:{input:function(){if(this.amount<=0)return this.receive=0,!1;this.receive=this.amount.toBN().times(this.rate).toFixed()},approve:function(){var t=this;this.$contracts.USDTToken.methods.approve(this.$contracts.Exchange._address,this.amount.toBN().times(10).toFixed().toWei()).send({from:this.$address}).on("transactionHash",(function(e){t.tradeState="approving"})).on("receipt",function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(a){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$contracts.USDTToken.methods.allowance(t.$address,t.$contracts.Exchange._address).call({from:t.$address});case 2:t.allowance=e.sent.fromWei().toBN(),i["a"].success(t.$t("genesisExchange.text8")),t.tradeState="none";case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).on("error",(function(e){t.tradeState="none"}))},exchange:function(){var t=this;if(this.amount<=0)return i["a"].fail(this.$t("genesisExchange.text9"));if(this.balance.toBN().lt(this.amount))return i["a"].fail(this.$t("genesisExchange.text10"));if(this.exchanged>0)return i["a"].fail(this.$t("genesisExchange.text11"));if(this.maxQuota.toBN().lt(this.amount))return i["a"].fail(this.$t("genesisExchange.text12"));if(this.allowance.lt(this.amount))return this.approve();var e=this.$contracts.Exchange.methods.swap(this.amount.toWei());e.call({from:this.$address},(function(a,n){a||e.send({from:t.$address}).on("transactionHash",(function(e){t.tradeState="trading"})).on("receipt",(function(e){t.$emit("reload"),t.init(),i["a"].success(t.$t("genesisExchange.text13")),t.amount="",t.receive=0,t.tradeState="none"})).on("error",(function(e){t.tradeState="none"}))}))},init:function(){var t=this,e=new this.$web3.BatchRequest;e.add(this.$contracts.Exchange.methods.BasisPrice().call.request({from:this.$address})),e.add(this.$contracts.USDTToken.methods.balanceOf(this.$address).call.request({from:this.$address})),e.add(this.$contracts.USDTToken.methods.allowance(this.$address,this.$contracts.Exchange._address).call.request({from:this.$address})),e.requestManager.sendBatch(e.requests,(function(e,a){e||(t.rate="1".toBN().div(a[0].result.decode(["uint256"]).fromWei()).toFixed(),t.balance=a[1].result.decode(["uint256"]).fromWei(),t.allowance=a[2].result.decode(["uint256"]).fromWei().toBN())}))}}},h=d,u=h,l=(a("593f"),a("2877")),m=Object(l["a"])(u,n,s,!1,null,"db611f68",null);e["default"]=m.exports},"593f":function(t,e,a){"use strict";a("c719")},c719:function(t,e,a){}}]);