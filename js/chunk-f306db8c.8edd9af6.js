(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f306db8c"],{"4e77":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{staticClass:"genesis-exchange"},[e("div",{staticClass:"remaining"},[e("div",{staticClass:"info"},[e("span",[t._v("1 USDT="+t._s(t.rate)+" "+t._s(t.$t("invitelist.text4"))+" ")]),e("span",[e("span",[t._v(t._s(t.exchanged))]),t._v("/"+t._s(t.maxQuota))])]),e("div",{staticClass:"proess"},[e("i",{style:{width:t.width+"%"}}),e("span",[t._v(t._s(t.width)+"%")])])]),e("div",{staticClass:"input"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.amount,expression:"amount"}],attrs:{type:"number",placeholder:t.$t("genesisExchange.text1")},domProps:{value:t.amount},on:{input:[function(e){e.target.composing||(t.amount=e.target.value)},t.input]}}),e("i"),e("span",[t._v("USDT")])]),e("span",{staticClass:"balance"},[t._v(t._s(t.$t("genesisExchange.text2"))),e("span",[t._v(t._s(t.balance))])]),e("span",{staticClass:"get"},[t._v(t._s(t.$t("genesisExchange.text3"))+" "),e("span",[t._v(t._s(t.receive))]),t._v(" "+t._s(t.$t("invitelist.text4")))]),e("van-button",{directives:[{name:"show",rawName:"v-show",value:"none"===t.tradeState&&!t.disableds,expression:"tradeState === 'none' && !disableds"}],staticClass:"double-button",on:{click:t.exchange}},[t._v(t._s(t.btnText))]),e("van-button",{directives:[{name:"show",rawName:"v-show",value:"none"===t.tradeState&&t.disableds,expression:"tradeState === 'none' && disableds"}],staticClass:"double-button",attrs:{disabled:""}},[t._v(t._s(t.btnText))]),e("van-button",{directives:[{name:"show",rawName:"v-show",value:"none"!==t.tradeState,expression:"tradeState !== 'none'"}],staticClass:"double-button",attrs:{loading:"","loading-text":t.btnText}})],1)},n=[],i=(s("e7e5"),s("d399")),o=(s("66b9"),s("b650")),r={components:{[o["a"].name]:o["a"]},props:{exchanged:[String,Number],maxQuota:[String,Number]},data(){return{rate:30,amount:"",balance:0,receive:0,allowance:"0".toBN(),tradeState:"none",disableds:!1}},computed:{width(){return this.exchanged.toBN().div(this.maxQuota).times(100).toFixed()},btnText(){return"approving"===this.tradeState?this.$t("genesisExchange.text4"):"trading"===this.tradeState?this.$t("genesisExchange.text5"):this.allowance.lt(this.amount)?this.$t("genesisExchange.text6"):this.$t("genesisExchange.text7")}},created(){this.$contracts&&this.init()},methods:{input(){if(this.amount<=0)return this.receive=0,!1;this.receive=this.amount.toBN().times(this.rate).toFixed()},approve(){this.$contracts.USDTToken.methods.approve(this.$contracts.Exchange._address,this.amount.toBN().times(10).toFixed().toWei()).send({from:this.$address}).on("transactionHash",t=>{this.tradeState="approving"}).on("receipt",async t=>{this.allowance=(await this.$contracts.USDTToken.methods.allowance(this.$address,this.$contracts.Exchange._address).call({from:this.$address})).fromWei().toBN(),i["a"].success(this.$t("genesisExchange.text8")),this.tradeState="none"}).on("error",t=>{this.tradeState="none"})},exchange(){if(this.amount<=0)return i["a"].fail(this.$t("genesisExchange.text9"));if(this.balance.toBN().lt(this.amount))return i["a"].fail(this.$t("genesisExchange.text10"));if(this.maxQuota.toBN().lt(this.amount))return i["a"].fail(this.$t("genesisExchange.text12"));if(this.allowance.lt(this.amount))return this.approve();const t=this.$contracts.Exchange.methods.subscribe(this.amount.toWei());t.call({from:this.$address},(e,s)=>{e||t.send({from:this.$address}).on("transactionHash",t=>{this.tradeState="trading"}).on("receipt",t=>{this.$emit("reload"),this.init(),i["a"].success(this.$t("genesisExchange.text13")),this.amount="",this.receive=0,this.tradeState="none"}).on("error",t=>{this.tradeState="none"})})},init(){this.$contracts.Exchange.methods.isCloseSubscribe().call({from:this.$address},(t,e)=>{t||(this.disableds=e)});const t=new this.$web3.BatchRequest;t.add(this.$contracts.USDTToken.methods.balanceOf(this.$address).call.request({from:this.$address})),t.add(this.$contracts.USDTToken.methods.allowance(this.$address,this.$contracts.Exchange._address).call.request({from:this.$address})),t.requestManager.sendBatch(t.requests,(t,e)=>{t||(this.balance=("string"===typeof e[0]?e[0]:e[0].result).decode(["uint256"]).fromWei().toFixed(4),this.allowance=e[1].result.decode(["uint256"]).fromWei().toBN())})}}},c=r,d=c,h=(s("c70c"),s("2877")),l=Object(h["a"])(d,a,n,!1,null,"0583a34a",null);e["default"]=l.exports},"8abb":function(t,e,s){},c70c:function(t,e,s){"use strict";s("8abb")}}]);